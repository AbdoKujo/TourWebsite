{% extends 'base.html' %}
{% load static %}
{% load cms_tags %}

{% block title %}Contact - Marrakech Activities Portal{% endblock %}

{% block content %}
<!-- header -->
<header class="flex header-sm">
    <div class="container">
        <div class="header-title">
            <h1>{% editable_text header_element 'title' %}</h1>
            <p>{% editable_text header_element 'description' %}</p>
        </div>
    </div>
</header>
<!-- header -->

<!-- contact section -->
<section id="contact" class="py-4">
    <div class="container">
        <div class="title-wrap">
            <span class="sm-title">get in touch with us</span>
            <h2 class="lg-title">contact us</h2>
        </div>
        <div class="contact-row">
            <div class="contact-left">
                {% if contact_elements %}
                    {% with contact_data=contact_elements.0.json_content|json_parse %}
                        <form class="contact-form" onsubmit="sendWhatsApp(); return false;">
                            {% for field in contact_data.form.fields %}
                                {% if field.type == 'textarea' %}
                                    <textarea rows="4" class="form-control" id="{{ field.name }}" placeholder="{{ field.label }}" style="resize: none;" {% if field.required %}required{% endif %}></textarea>
                                {% else %}
                                    <input type="{{ field.type }}" class="form-control" id="{{ field.name }}" placeholder="{{ field.label }}" {% if field.required %}required{% endif %}>
                                {% endif %}
                            {% endfor %}
                            <button type="submit" class="btn">{{ contact_data.form.submit_text }}</button>
                        </form>
                        
                        <script>
                        function sendWhatsApp() {
                            let name = document.getElementById("name").value;
                            let email = document.getElementById("email").value;
                            let message = document.getElementById("message").value;
                        
                            let phoneNumber = "{{ contact_data.form.whatsapp_number }}"; // WhatsApp number
                            let whatsappLink = `https://wa.me/${phoneNumber}?text=Name: ${encodeURIComponent(name)}%0AEmail: ${encodeURIComponent(email)}%0AMessage: ${encodeURIComponent(message)}`;
                        
                            window.location.href = whatsappLink;
                        }
                        </script>
                    {% endwith %}
                {% else %}
                    <!-- Fallback form if no elements in database -->
                    <form class="contact-form" onsubmit="sendWhatsApp(); return false;">
                        <input type="text" class="form-control" id="name" placeholder="Your name" required>
                        <input type="email" class="form-control" id="email" placeholder="Your email" required>
                        <textarea rows="4" class="form-control" id="message" placeholder="Your message" style="resize: none;" required></textarea>
                        <button type="submit" class="btn">Send message</button>
                    </form>
                    
                    <script>
                    function sendWhatsApp() {
                        let name = document.getElementById("name").value;
                        let email = document.getElementById("email").value;
                        let message = document.getElementById("message").value;
                    
                        let phoneNumber = "212643562320"; // Replace with your WhatsApp number
                        let whatsappLink = `https://wa.me/${phoneNumber}?text=Name: ${encodeURIComponent(name)}%0AEmail: ${encodeURIComponent(email)}%0AMessage: ${encodeURIComponent(message)}`;
                    
                        window.location.href = whatsappLink;
                    }
                    </script>
                {% endif %}
            </div>
            
            <div class="contact-right my-2">
                {% if contact_elements %}
                    {% with contact_data=contact_elements.0.json_content|json_parse %}
                        {% for info in contact_data.contact_info %}
                            <div class="contact-item">
                                <span class="contact-icon flex">
                                    <i class="{{ info.icon }}"></i>
                                </span>
                                <div>
                                    <span>{{ info.title }}</span>
                                    {% if info.link %}
                                        <p class="text">
                                            <a href="{{ info.link }}" target="_blank">{{ info.content }}</a>
                                        </p>
                                    {% else %}
                                        <p class="text">{{ info.content }}</p>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    {% endwith %}
                {% else %}
                    <!-- Fallback contact info if no elements in database -->
                    <div class="contact-item">
                        <span class="contact-icon flex">
                            <i class="fa fa-phone-alt"></i>
                        </span>
                        <div>
                            <span>Phone</span>
                            <p class="text">+212643562320</p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <span class="contact-icon flex">
                            <i class="fa fa-map-marked-alt"></i>
                        </span>
                        <div>
                            <span>Address</span>
                            <p class="text">
                                <a href="https://maps.app.goo.gl/fdoKHvVYEAToYJk98" target="_blank">Rue Mohammed V, 2ème étage, n°10, Immeuble royal Air Maroc guilez</a>
                            </p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <span class="contact-icon flex">
                            <i class="fa fa-envelope"></i>
                        </span>
                        <div>
                            <span>Message</span>
                            <p class="text">moubela276@gmail.com</p>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>
<!-- end of contact section -->
{% endblock %}
